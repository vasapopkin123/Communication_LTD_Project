<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Communication_LTD - ×¤×× ×œ × ×™×”×•×œ</title>
  <style>
    body { font-family: Arial; background: #f4f7f6; margin: 0; }
    .navbar { background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    .nav-buttons a { color: white; text-decoration: none; padding: 10px 14px; background: #34495e; border-radius: 6px; margin-left: 10px; }
    .container { padding: 30px; text-align: center; }
    .form-group { background: white; padding: 20px; border-radius: 10px; width: 420px; margin: 0 auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc; }
    button { width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background: #1e8449; }
    .btn-view { background: #3498db; margin-top: 15px; }
    .btn-view:hover { background: #2d80b8; }
    #welcomeMessage { margin-top: 12px; color: #27ae60; }
    #loggedInAs { margin: 10px 0 20px; }
  </style>
</head>
<body>

<div class="navbar">
  <div>Communication_LTD - ×¤×× ×œ × ×™×”×•×œ</div>
  <div class="nav-buttons">
    <a id="changePassBtn" href="change_password.html">âš™ï¸ ×©×™× ×•×™ ×¡×™×¡××”</a>
    <a href="#" onclick="logout()" style="background:#e74c3c;">×™×¦×™××”</a>
  </div>
</div>

<div class="container">
  <h1>× ×™×”×•×œ ×œ×§×•×—×•×ª</h1>
  <p id="loggedInAs"></p>

  <div class="form-group">
    <h3>×”×•×¡×¤×ª ×œ×§×•×— ×—×“×©</h3>
    <input type="text" id="firstName" placeholder="×©× ×¤×¨×˜×™">
    <input type="text" id="lastName" placeholder="×©× ××©×¤×—×”">
    <button onclick="addCust()">×”×•×¡×£ ×œ××¢×¨×›×ª</button>
    <div id="welcomeMessage"></div>
  </div>

  <button class="btn-view" onclick="window.location.href='customers.html'">ğŸ“‚ ×¦×¤×” ×‘×¨×©×™××ª ×›×œ ×”×œ×§×•×—×•×ª</button>
</div>

<script>
  function authToken() {
    return localStorage.getItem("auth_token");
  }

  function authHeaders() {
    return {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + authToken()
    };
  }

  async function requireLogin() {
    if (!authToken()) {
      window.location.href = "index.html";
      return;
    }
    const res = await fetch("http://localhost:5000/me", { headers: { "Authorization": "Bearer " + authToken() } });
    if (!res.ok) {
      localStorage.removeItem("auth_token");
      window.location.href = "index.html";
      return;
    }
    const me = await res.json();
    document.getElementById('loggedInAs').innerText = "××—×•×‘×¨ ×›×¨×’×¢: " + me.username;
  }

  async function addCust() {
    const welcome = document.getElementById('welcomeMessage');
    welcome.innerText = "";

    const first_name = document.getElementById('firstName').value.trim();
    const last_name  = document.getElementById('lastName').value.trim();

    if (!first_name || !last_name) {
      alert("× × ×œ×”×–×™×Ÿ ×©× ×¤×¨×˜×™ ×•×©× ××©×¤×—×”");
      return;
    }

    try {
      const response = await fetch("http://localhost:5000/add-customer", {
        method: "POST",
        headers: authHeaders(),
        body: JSON.stringify({ first_name, last_name })
      });

      const data = await response.json();

      if (!response.ok) {
        alert(data.detail || "×©×’×™××” ×‘×”×•×¡×¤×ª ×œ×§×•×—");
        return;
      }

      welcome.innerText = `âœ… ×”×œ×§×•×— ${data.customer_name} × ×•×¡×£ ×‘×”×¦×œ×—×”!`;
      document.getElementById('firstName').value = "";
      document.getElementById('lastName').value = "";
    } catch (e) {
      alert("×©×’×™××” ×‘×—×™×‘×•×¨ ×œ×©×¨×ª");
    }
  }

  async function logout() {
    try {
      await fetch("http://localhost:5000/logout", {
        method: "POST",
        headers: { "Authorization": "Bearer " + authToken() }
      });
    } catch (e) {}
    localStorage.removeItem("auth_token");
    window.location.href = "index.html";
  }

  requireLogin();
</script>

</body>
</html>